pipeline {
  agent any
  environment {
    GOPROXY = 'https://goproxy.cn,direct'
    GOVERSION = "1.19.12"
    GOTMPENV = "/tmp/go-tmp-env/$GOVERSION"
    GOROOT = "$GOTMPENV/goroot"
    GOPATH = "$GOTMPENV/gopath"
    GOBIN = "$GOROOT/bin"
    PATH = "$GOBIN:$PATH"
  }
  stages{
    stage("set-golang-env"){
      steps {
        sh 'make prepare-golang-env'
      }
    }

    stage("test-golang"){
       steps {
        sh (returnStdout: false, script: '''
          go version
        '''.stripIndent())
      }
    }
  }
}
